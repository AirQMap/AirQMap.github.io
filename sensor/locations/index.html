<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Sensor Profile</title>
    <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
    <script src="./assets/js/index.js"></script>
  </head>
  <body>
    <noscript>A JavaScipt le van tiltva.</noscript>
    <div id="map"></div>
    <script>
        
        let loadTable = e => {
            fetch(`
https://airqmap.divaldo.hu/odata/
?table=Devices
&columns=DeviceID;Sensors;Lat;Lon;Maintenance
&query=
filter=substr(${search.value},DeviceID)
`)
            .then(res=>res.json())
            .then(res=> {
                let map = new Microsoft.Maps.Map("#map", {
                    credentials: "ArSyAqCFpDbMrF8monFxY9PomZbiBHLhUJ3sFFZeNBLI_b8Rr3J0TUDHSAjkc3AG",
                    //center: new Microsoft.Maps.Location(sensorDetails.Lat, sensorDetails.Lon),
                    zoom: 3,
                    enableClickableLogo: false,
                    mapTypeId: Microsoft.Maps.MapTypeId.aerial
                });
                res.forEach(elem => {
                    if(elem.Lat && elem.Lon) {
                        let loc = new Microsoft.Maps.Location(elem.Lat, elem.Lon);
                        map.entities.push(new Microsoft.Maps.Pushpin(loc, {
                            title: elem.DeviceID
                        }));
                    }
                });
            });
        }
        loadTable();
    </script>
  </body>
</html>